import{r as n,j as q,q as A,e as H,u as E,c as d,a as t,h as I,x as h,y as k,g as o,z as _,t as a,F as f,m as b,B as P,o as i,p as $,v as R}from"./sX_wM5Ua.js";import{s as J}from"./x_rD_Ya3.js";const G={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},K={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8"},Q={class:"mt-4 lg:mt-0 flex space-x-3"},W={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},X={class:"card p-6"},Y={class:"flex items-center"},Z={class:"ml-4"},tt={class:"text-2xl font-semibold text-gray-900 dark:text-white"},et={class:"card p-6"},st={class:"flex items-center"},at={class:"ml-4"},ot={class:"text-2xl font-semibold text-gray-900 dark:text-white"},lt={class:"card p-6"},rt={class:"flex items-center"},dt={class:"ml-4"},it={class:"text-2xl font-semibold text-gray-900 dark:text-white"},nt={class:"card p-6"},ct={class:"flex items-center"},xt={class:"ml-4"},ut={class:"text-2xl font-semibold text-gray-900 dark:text-white"},gt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"},pt={class:"card p-6"},mt={class:"space-y-4"},yt={class:"flex items-center space-x-3"},vt={class:"text-sm font-medium text-gray-900 dark:text-white"},ft={class:"flex items-center space-x-4"},bt={class:"text-sm text-gray-600 dark:text-gray-400"},wt={class:"w-24 bg-gray-200 rounded-full h-2 dark:bg-gray-700"},ht={class:"text-sm font-medium text-green-600"},kt={class:"card p-6"},_t={class:"space-y-3"},Rt={class:"flex items-center space-x-3"},St={class:"text-sm text-gray-900 dark:text-white"},jt={class:"text-sm font-medium text-gray-600 dark:text-gray-400"},Ut={class:"card p-6 mb-8"},Mt={class:"flex items-center justify-between mb-6"},zt={class:"overflow-x-auto"},Bt={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ct={class:"bg-white dark:bg-dark-100 divide-y divide-gray-200 dark:divide-gray-700"},Lt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400"},$t={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400"},Tt={class:"px-6 py-4 whitespace-nowrap"},Ft={class:"px-6 py-4 whitespace-nowrap"},Nt={class:"flex items-center"},Ot={class:"w-16 bg-gray-200 rounded-full h-2 mr-2"},qt={class:"text-sm font-medium text-gray-900 dark:text-white"},At={class:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8"},Ht={class:"card p-6"},Et={class:"space-y-4"},It={class:"flex justify-between items-center"},Pt={class:"font-semibold text-gray-900 dark:text-white"},Jt={class:"flex justify-between items-center"},Gt={class:"font-semibold text-gray-900 dark:text-white"},Kt={class:"flex justify-between items-center"},Qt={class:"font-semibold text-gray-900 dark:text-white"},Wt={class:"flex justify-between items-center"},Xt={class:"font-semibold text-gray-900 dark:text-white"},Yt={class:"flex justify-between items-center"},Zt={class:"font-semibold text-gray-900 dark:text-white"},te={class:"card p-6"},ee={class:"space-y-3"},se={class:"text-sm text-gray-900 dark:text-white"},ae={class:"flex items-center space-x-3"},oe={class:"text-sm text-gray-600 dark:text-gray-400"},le={class:"text-sm font-medium text-green-600"},re={class:"card p-6 mb-8"},de={class:"flex items-center justify-between mb-6"},ie={class:"flex items-center space-x-2"},ne={class:"text-sm text-gray-600 dark:text-gray-400"},ce={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},xe={class:"bg-blue-50 dark:bg-blue-900 rounded-lg p-4"},ue={class:"flex items-center justify-between"},ge={class:"text-2xl font-bold text-blue-900 dark:text-blue-100"},pe={class:"bg-yellow-50 dark:bg-yellow-900 rounded-lg p-4"},me={class:"flex items-center justify-between"},ye={class:"text-2xl font-bold text-yellow-900 dark:text-yellow-100"},ve={class:"bg-red-50 dark:bg-red-900 rounded-lg p-4"},fe={class:"flex items-center justify-between"},be={class:"text-2xl font-bold text-red-900 dark:text-red-100"},we={key:0,class:"fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50 flex items-center justify-center p-4"},he={class:"bg-white dark:bg-dark-100 rounded-xl shadow-2xl max-w-lg w-full"},ke={class:"px-6 py-4 space-y-4"},_e={class:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3"},Re=["disabled"],Me={__name:"analytics",setup(Se){const x=n("24h"),l=n({}),w=n(!1),m=n(!1),u=n("user_actions"),g=n("json"),y=n(!1),v=n({activeSessions:12,stuckUsers:3,masterRequests:5}),S=n(new Date().toLocaleTimeString("ru-RU")),T=q(()=>l.value.deviceUsage?Math.max(...l.value.deviceUsage.map(r=>r.sessions)):1),j=async()=>{try{const r=await $fetch(`/api/admin/analytics?range=${x.value}`);l.value=r}catch(r){console.error("Failed to load analytics:",r)}},F=()=>{m.value=!0},N=async()=>{y.value=!0;try{const r=await $fetch("/api/admin/reports",{method:"POST",body:{type:u.value,format:g.value,timeRange:x.value,filters:{}}}),e=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),p=URL.createObjectURL(e),c=document.createElement("a");c.href=p,c.download=`${u.value}_report_${x.value}.${g.value}`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(p),m.value=!1}catch(r){console.error("Failed to generate report:",r),alert("Ошибка при генерации отчета")}finally{y.value=!1}};A(x,j);const O=()=>{v.value={activeSessions:Math.floor(Math.random()*20)+5,stuckUsers:Math.floor(Math.random()*10),masterRequests:Math.floor(Math.random()*15)+2},S.value=new Date().toLocaleTimeString("ru-RU")};return H(async()=>{await j(),J(O,3e4)}),E({title:"Аналитика - Админ-панель"}),(r,e)=>{var p,c,U,M,z,B,C,L,V,D;return i(),d("div",G,[t("div",K,[e[6]||(e[6]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"📊 Аналитика и отчеты"),t("p",{class:"mt-2 text-gray-600 dark:text-gray-400"}," Детальная аналитика использования системы диагностики ")],-1)),t("div",Q,[h(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>_(x)?x.value=s:null),class:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},e[5]||(e[5]=[t("option",{value:"24h"},"Последние 24 часа",-1),t("option",{value:"7d"},"Последние 7 дней",-1),t("option",{value:"30d"},"Последние 30 дней",-1)]),512),[[k,o(x)]]),t("button",{onClick:F,class:"btn-primary"}," 📄 Сгенерировать отчет ")])]),t("div",W,[t("div",X,[t("div",Y,[e[8]||(e[8]=t("div",{class:"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg"},[t("svg",{class:"w-6 h-6 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",Z,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Всего сессий",-1)),t("p",tt,a(((p=o(l).overview)==null?void 0:p.totalSessions)||0),1)])])]),t("div",et,[t("div",st,[e[10]||(e[10]=t("div",{class:"p-3 bg-green-100 dark:bg-green-900 rounded-lg"},[t("svg",{class:"w-6 h-6 text-green-600",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),t("div",at,[e[9]||(e[9]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Успешно завершено",-1)),t("p",ot,a(((c=o(l).overview)==null?void 0:c.completedSessions)||0),1)])])]),t("div",lt,[t("div",rt,[e[12]||(e[12]=t("div",{class:"p-3 bg-yellow-100 dark:bg-yellow-900 rounded-lg"},[t("svg",{class:"w-6 h-6 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),t("div",dt,[e[11]||(e[11]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Прерваны",-1)),t("p",it,a(((U=o(l).overview)==null?void 0:U.abandonedSessions)||0),1)])])]),t("div",nt,[t("div",ct,[e[14]||(e[14]=t("div",{class:"p-3 bg-purple-100 dark:bg-purple-900 rounded-lg"},[t("svg",{class:"w-6 h-6 text-purple-600",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"}),t("path",{"fill-rule":"evenodd",d:"M4 5a2 2 0 012-2v1a1 1 0 102 0V3a2 2 0 012 2v6.5A1.5 1.5 0 009.5 13h-3A1.5 1.5 0 015 11.5V5zM7 7a1 1 0 011-1h.01a1 1 0 110 2H8a1 1 0 01-1-1z","clip-rule":"evenodd"})])],-1)),t("div",xt,[e[13]||(e[13]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"Процент успеха",-1)),t("p",ut,a(((M=o(l).overview)==null?void 0:M.successRate)||0)+"%",1)])])])]),t("div",gt,[t("div",pt,[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," 📱 Использование по устройствам ",-1)),t("div",mt,[(i(!0),d(f,null,b(o(l).deviceUsage,s=>(i(),d("div",{key:s.device,class:"flex items-center justify-between"},[t("div",yt,[e[15]||(e[15]=t("div",{class:"w-4 h-4 bg-primary-600 rounded"},null,-1)),t("span",vt,a(s.device),1)]),t("div",ft,[t("span",bt,a(s.sessions)+" сессий",1),t("div",wt,[t("div",{class:"bg-primary-600 h-2 rounded-full",style:$(`width: ${s.sessions/o(T)*100}%`)},null,4)]),t("span",ht,a(s.successRate)+"%",1)])]))),128))])]),t("div",kt,[e[17]||(e[17]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," ⚠️ Распределение ошибок ",-1)),t("div",_t,[(i(!0),d(f,null,b((z=o(l).errorDistribution)==null?void 0:z.slice(0,5),s=>(i(),d("div",{key:s.error,class:"flex items-center justify-between"},[t("div",Rt,[t("div",{class:R(["w-3 h-3 rounded-full",{"bg-red-500":s.severity==="high","bg-yellow-500":s.severity==="medium","bg-green-500":s.severity==="low"}])},null,2),t("span",St,a(s.error),1)]),t("span",jt,a(s.count),1)]))),128))])])]),t("div",Ut,[t("div",Mt,[e[18]||(e[18]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," 📋 Анализ производительности шагов ",-1)),t("button",{onClick:e[1]||(e[1]=s=>w.value=!o(w)),class:"text-sm text-primary-600 hover:text-primary-700"},a(o(w)?"Скрыть детали":"Показать детали"),1)]),t("div",zt,[t("table",Bt,[e[19]||(e[19]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Шаг "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Просмотры "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Завершения "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Среднее время "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Застряли "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Успех % ")])],-1)),t("tbody",Ct,[(i(!0),d(f,null,b(o(l).stepAnalytics,s=>(i(),d("tr",{key:s.stepId},[t("td",Lt,a(s.stepTitle),1),t("td",Vt,a(s.views),1),t("td",Dt,a(s.completions),1),t("td",$t,a(s.avgTimeSpent),1),t("td",Tt,[t("span",{class:R(["px-2 py-1 text-xs rounded-full",{"bg-red-100 text-red-800":s.stuckUsers>10,"bg-yellow-100 text-yellow-800":s.stuckUsers>5&&s.stuckUsers<=10,"bg-green-100 text-green-800":s.stuckUsers<=5}])},a(s.stuckUsers),3)]),t("td",Ft,[t("div",Nt,[t("div",Ot,[t("div",{class:R(["h-2 rounded-full",{"bg-green-500":s.successRate>=80,"bg-yellow-500":s.successRate>=60&&s.successRate<80,"bg-red-500":s.successRate<60}]),style:$(`width: ${s.successRate}%`)},null,6)]),t("span",qt,a(s.successRate)+"%",1)])])]))),128))])])])]),t("div",At,[t("div",Ht,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," 👥 Поведение пользователей ",-1)),t("div",Et,[t("div",It,[e[20]||(e[20]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Средние шаги за сессию:",-1)),t("span",Pt,a(((B=o(l).userBehavior)==null?void 0:B.averageStepsPerSession)||0),1)]),t("div",Jt,[e[21]||(e[21]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Самый сложный шаг:",-1)),t("span",Gt,a(((C=o(l).userBehavior)==null?void 0:C.mostDifficultStep)||"Н/Д"),1)]),t("div",Kt,[e[22]||(e[22]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Самое быстрое завершение:",-1)),t("span",Qt,a(((L=o(l).userBehavior)==null?void 0:L.fastestCompletion)||"Н/Д"),1)]),t("div",Wt,[e[23]||(e[23]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Вмеша��ельства оператора:",-1)),t("span",Xt,a(((V=o(l).userBehavior)==null?void 0:V.operatorInterventions)||0),1)]),t("div",Yt,[e[24]||(e[24]=t("span",{class:"text-sm text-gray-600 dark:text-gray-400"},"Использование альтернатив:",-1)),t("span",Zt,a(((D=o(l).userBehavior)==null?void 0:D.alternativePathUsage)||0),1)])])]),t("div",te,[e[26]||(e[26]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"}," 🌍 География пользователей ",-1)),t("div",ee,[(i(!0),d(f,null,b(o(l).geographicData,s=>(i(),d("div",{key:s.region,class:"flex items-center justify-between"},[t("span",se,a(s.region),1),t("div",ae,[t("span",oe,a(s.sessions),1),t("span",le,a(s.successRate)+"%",1)])]))),128))])])]),t("div",re,[t("div",de,[e[28]||(e[28]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," 🔴 Активность в реальном времени ",-1)),t("div",ie,[e[27]||(e[27]=t("div",{class:"w-2 h-2 bg-green-400 rounded-full animate-pulse"},null,-1)),t("span",ne,"Обновлено "+a(o(S)),1)])]),t("div",ce,[t("div",xe,[t("div",ue,[t("div",null,[e[29]||(e[29]=t("p",{class:"text-sm font-medium text-blue-800 dark:text-blue-200"},"Активные сессии",-1)),t("p",ge,a(o(v).activeSessions),1)]),e[30]||(e[30]=t("div",{class:"p-3 bg-blue-100 dark:bg-blue-800 rounded-full"},[t("svg",{class:"w-6 h-6 text-blue-600",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1))])]),t("div",pe,[t("div",me,[t("div",null,[e[31]||(e[31]=t("p",{class:"text-sm font-medium text-yellow-800 dark:text-yellow-200"},"Застряли",-1)),t("p",ye,a(o(v).stuckUsers),1)]),e[32]||(e[32]=t("div",{class:"p-3 bg-yellow-100 dark:bg-yellow-800 rounded-full"},[t("svg",{class:"w-6 h-6 text-yellow-600",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1))])]),t("div",ve,[t("div",fe,[t("div",null,[e[33]||(e[33]=t("p",{class:"text-sm font-medium text-red-800 dark:text-red-200"},"Заявки на мастера",-1)),t("p",be,a(o(v).masterRequests),1)]),e[34]||(e[34]=t("div",{class:"p-3 bg-red-100 dark:bg-red-800 rounded-full"},[t("svg",{class:"w-6 h-6 text-red-600",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1))])])])]),o(m)?(i(),d("div",we,[t("div",he,[e[39]||(e[39]=t("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Генерация отчета ")],-1)),t("div",ke,[t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Тип отчета ",-1)),h(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>_(u)?u.value=s:null),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},e[35]||(e[35]=[P('<option value="user_actions">Действия пользователей</option><option value="step_performance">Производительность шагов</option><option value="device_analytics">Аналитика устройств</option><option value="error_analysis">Анализ ошибок</option><option value="operator_metrics">Метрики операторов</option>',5)]),512),[[k,o(u)]])]),t("div",null,[e[38]||(e[38]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Формат ",-1)),h(t("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>_(g)?g.value=s:null),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},e[37]||(e[37]=[t("option",{value:"json"},"JSON",-1),t("option",{value:"csv"},"CSV",-1),t("option",{value:"excel"},"Excel",-1)]),512),[[k,o(g)]])])]),t("div",_e,[t("button",{onClick:e[4]||(e[4]=s=>m.value=!1),class:"btn-secondary"}," Отмена "),t("button",{onClick:N,disabled:o(y),class:"btn-primary"},a(o(y)?"Генерация...":"Скачать"),9,Re)])])])):I("",!0)])}}};export{Me as default};
