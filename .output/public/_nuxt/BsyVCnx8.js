import{_ as le}from"./BxAFrtwI.js";import{u as oe}from"./C3Nop_WK.js";import{s as ne}from"./x_rD_Ya3.js";import{r as b,j as D,e as ae,u as ie,c as n,o as a,a as s,h as c,t as r,g as e,F as y,m as k,v as F,d as M,b as re,p as ce}from"./sX_wM5Ua.js";import{_ as ue}from"./DlAUqK2U.js";const de={class:"diagnostic-container"},ve={class:"flex items-center justify-between mb-6"},be={class:"flex items-center space-x-4"},ge={class:"flex items-center space-x-2"},me={class:"text-sm text-gray-600 dark:text-gray-400"},fe={key:0,class:"px-2 py-1 text-xs bg-orange-100 text-orange-800 dark:bg-orange-800 dark:text-orange-100 rounded-full"},pe={class:"flex space-x-1"},he=["title"],_e={key:0,class:"absolute -top-1 -right-1 text-xs text-orange-500"},xe={class:"diagnostic-main"},ye={class:"tv-screen-container"},ke={class:"tv-screen"},we={key:0,class:"w-full h-full"},Ce=["src"],Se=["src","alt"],$e=["src","alt"],Ie=["src","alt"],ze={key:2,class:"w-full h-full flex items-center justify-center"},je={class:"text-center text-white"},Pe={class:"text-6xl mb-4"},Be={class:"text-lg"},Me={class:"absolute top-4 right-4 bg-black bg-opacity-75 text-white px-3 py-1 rounded text-sm"},qe={key:3,class:"absolute bottom-4 left-4 bg-black bg-opacity-75 text-white p-4 rounded"},Ne={class:"space-y-2"},Ve={key:0},Le={class:"font-mono"},De={key:1},Fe={class:"font-mono"},Re={key:2},Te={class:"font-mono"},Ae={class:"remote-container"},He={class:"card p-6"},Oe={key:0,class:"mb-4 p-3 bg-blue-50 dark:bg-blue-900 rounded-lg"},Ee={class:"text-sm text-blue-700 dark:text-blue-300 space-y-1"},Ue={class:"flex-shrink-0 w-5 h-5 bg-blue-600 text-white text-xs rounded-full flex items-center justify-center"},Qe={class:"card p-6"},Ge={class:"flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4"},Je={class:"flex-1"},Ke={class:"flex items-center space-x-2 mb-2"},We={class:"text-xl font-semibold text-gray-900 dark:text-white"},Xe={class:"text-gray-600 dark:text-gray-400 mb-4"},Ye={key:0,class:"bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg p-3 mb-4"},Ze={class:"flex items-start space-x-2"},et={class:"text-sm text-blue-800 dark:text-blue-200"},tt={key:1,class:"bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-lg p-3 mb-4"},st=["href"],lt={key:0,class:"text-xs text-gray-500"},ot={key:2,class:"bg-yellow-50 dark:bg-yellow-900 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4 mb-4"},nt={class:"text-sm font-medium text-yellow-800 dark:text-yellow-200 mb-3"},at={class:"space-y-2"},it=["onClick"],rt={key:3,class:"bg-blue-50 dark:bg-blue-900 border border-blue-200 dark:border-blue-700 rounded-lg p-4 mb-4"},ct={class:"mt-2 w-full bg-blue-200 dark:bg-blue-700 rounded-full h-2"},ut={class:"flex flex-col space-y-3 lg:ml-6"},dt=["disabled"],vt={key:0,class:"fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50 flex items-center justify-center p-4"},bt={class:"bg-white dark:bg-dark-100 rounded-xl shadow-2xl max-w-md w-full p-6"},gt={class:"text-center"},mt={class:"text-6xl mb-4"},ft={class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"},pt={class:"text-gray-600 dark:text-gray-400 mb-6"},ht={key:0,class:"space-y-3"},_t=["onClick"],xt={key:1},yt={key:1,class:"fixed bottom-4 right-4 z-50"},kt=["title"],wt={key:0,class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},Ct={key:1,class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20"},St={key:2,class:"absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full animate-pulse"},$t=["src"],It={__name:"EnhancedDiagnosticScreen",props:{device:{type:Object,required:!0},error:{type:Object,required:!0}},emits:["back","restart"],setup(C,{emit:R}){const h=C,S=R,u=b([]),d=b(0);oe(),b(null);const f=b(!1),w=b(null),_=b([]),p=b(!1),v=b({}),$=b(!1),x=b(0),I=b(!1),T=b(15),A=b(35),t=D(()=>!u.value||u.value.length===0?{}:u.value[d.value]||{}),H=D(()=>{var l;return(l=t.value.actions)==null?void 0:l.some(o=>o.type==="link")}),O=l=>{var o,m,i,g,V,L;return(o=l.title)!=null&&o.includes("Проверить баланс")?"����":(m=l.title)!=null&&m.includes("карту")?"🎫":(i=l.title)!=null&&i.includes("антенн")?"📡":(g=l.title)!=null&&g.includes("поиск")?"🔍":(V=l.title)!=null&&V.includes("сигнал")?"📶":(L=l.title)!=null&&L.includes("кабель")?"🔌":"📺"},E=l=>l<d.value?"bg-green-500":l===d.value?"bg-primary-500":"bg-gray-300 dark:bg-gray-600",U=()=>t.value.actions?t.value.actions.filter(l=>l.buttonId).map(l=>l.buttonId):t.value.highlighted_buttons||[],Q=()=>{var l;return((l=t.value.actions)==null?void 0:l.filter(o=>o.type==="link"))||[]},z=()=>d.value<u.value.length-1&&!t.value.userConfirmation,G=()=>d.value===u.value.length-1,q=()=>t.value.actions?t.value.actions.filter(o=>o.buttonId).every(o=>_.value.includes(o.buttonId)):!0,j=()=>{if(t.value.nextIfSuccess){const l=t.value.nextIfSuccess;typeof l=="number"?d.value=Math.min(l-1,u.value.length-1):P(l)}else z()&&d.value++;_.value=[],t.value.progress&&ee(),t.value.validation&&(I.value=!0)},J=()=>{d.value>0&&(d.value--,_.value=[],I.value=!1)},K=l=>{var o;console.log("Button pressed:",l),(o=t.value.actions)!=null&&o.some(m=>m.buttonId===l)&&(_.value.includes(l)||_.value.push(l)),q()&&!t.value.userConfirmation&&setTimeout(()=>{z()&&j()},800)},W=l=>{l.action==="completion_success"?B():l.action==="call_master"?N():typeof l.action=="number"?(d.value=l.action-1,j()):P(l.action)},X=()=>{if(t.value.ifNoResult){const l=t.value.ifNoResult.nextStepId,o=u.value.findIndex(m=>m.id==l);o!==-1&&(d.value=o)}},P=l=>{switch(l){case"completion_success":B();break;case"call_master":N();break;case"restart":S("restart");break;case"select_error":S("back");break;case"select_device":S("restart");break;default:console.log("Unknown action:",l)}},B=()=>{v.value={success:!0,title:"✅ Проблема решена",description:"Отлично! Диагностика завершена успешно."},p.value=!0},N=()=>{v.value={success:!1,title:"🚫 Требуется мастер",description:"Мы приняли заявку, мастер скоро прибудет.",action:{type:"submit_request",buttonText:"Подать заявку",endpoint:"/api/master-request"}},p.value=!0},Y=l=>{p.value=!1,P(l.action)},Z=async()=>{try{await new Promise(l=>setTimeout(l,1e3)),v.value.description="Заявка отправлена! Мастер свяжется с вами в ближайшее время.",v.value.action=null}catch(l){console.error("Failed to submit request:",l)}},ee=()=>{$.value=!0,x.value=0;const l=ne(()=>{x.value+=10,x.value>=100&&(clearInterval(l),$.value=!1,x.value=0)},500)},te=()=>{t.value.completion?t.value.completion.success?(v.value=t.value.completion.success,p.value=!0):t.value.completion.failure&&(v.value=t.value.completion.failure,p.value=!0):B()},se=()=>{w.value&&(f.value?w.value.pause():w.value.play())};return ae(async()=>{try{const l=await $fetch(`/api/steps/${h.device.id}/${h.error.id}`);u.value=l||[],u.value.length===0&&(u.value=[{id:1,title:"Диагностика начата",instruction:`Начинаем диагностику ошибки "${h.error.title}" для ${h.device.name}`,tip:"Следуйте инструкциям на экране",highlighted_buttons:[],actions:[],audio_url:null}])}catch(l){console.error("Failed to load steps:",l),u.value=[]}}),ie({title:`Диагностика ${h.device.name} - ${h.error.title}`}),(l,o)=>{const m=le;return a(),n("div",de,[s("div",ve,[s("button",{onClick:o[0]||(o[0]=i=>l.$emit("back")),class:"btn-secondary"}," ← Назад к ошибкам "),s("div",be,[s("div",ge,[s("span",me," Шаг "+r(e(d)+1)+" из "+r(e(u).length),1),e(t).onlyForOperator?(a(),n("span",fe," Для оператора ")):c("",!0)]),s("div",pe,[(a(!0),n(y,null,k(e(u),(i,g)=>(a(),n("div",{key:g,class:F(["w-3 h-3 rounded-full transition-colors relative",E(g)]),title:i.title},[i.onlyForOperator?(a(),n("span",_e,"👤")):c("",!0)],10,he))),128))])]),s("button",{onClick:o[1]||(o[1]=i=>l.$emit("restart")),class:"btn-secondary"}," Начать заново ")]),s("div",xe,[s("div",ye,[s("div",ke,[e(t).media?(a(),n("div",we,[e(t).media.type==="video"?(a(),n("video",{key:0,src:e(t).media.url,class:"w-full h-full object-cover",controls:"",muted:"",autoplay:""},null,8,Ce)):e(t).media.type==="animation"?(a(),n("img",{key:1,src:e(t).media.url,alt:e(t).media.description,class:"w-full h-full object-cover"},null,8,Se)):e(t).media.type==="image"?(a(),n("img",{key:2,src:e(t).media.url,alt:e(t).title,class:"w-full h-full object-cover"},null,8,$e)):c("",!0)])):e(t).screen_image?(a(),n("img",{key:1,src:e(t).screen_image,alt:e(t).title,class:"w-full h-full object-cover"},null,8,Ie)):(a(),n("div",ze,[s("div",je,[s("div",Pe,r(O(e(t))),1),s("p",Be,r(e(t).title),1)])])),s("div",Me,r(C.device.name),1),e(t).validation&&e(I)?(a(),n("div",qe,[s("div",Ne,[e(t).validation.signalLevel?(a(),n("div",Ve,[o[6]||(o[6]=M(" Уровень: ")),s("span",Le,r(e(T))+"%",1)])):c("",!0),e(t).validation.signalQuality?(a(),n("div",De,[o[7]||(o[7]=M(" Качество: ")),s("span",Fe,r(e(A))+"%",1)])):c("",!0),e(t).validation.satellite?(a(),n("div",Re,[o[8]||(o[8]=M(" Спутник: ")),s("span",Te,r(e(t).validation.satellite),1)])):c("",!0)])])):c("",!0)])]),s("div",Ae,[s("div",He,[o[10]||(o[10]=s("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-4 text-center"}," Пульт управления ",-1)),e(t).actions&&e(t).actions.length>0?(a(),n("div",Oe,[o[9]||(o[9]=s("h4",{class:"text-sm font-medium text-blue-800 dark:text-blue-200 mb-2"},"Выполните действия:",-1)),s("ol",Ee,[(a(!0),n(y,null,k(e(t).actions,(i,g)=>(a(),n("li",{key:g,class:"flex items-center space-x-2"},[s("span",Ue,r(g+1),1),s("span",null,r(i.description),1)]))),128))])])):c("",!0),re(m,{device:C.device,"highlighted-buttons":U(),"completed-actions":e(_),onButtonPress:K},null,8,["device","highlighted-buttons","completed-actions"])])])]),s("div",Qe,[s("div",Ge,[s("div",Je,[s("div",Ke,[s("h3",We,r(e(t).title),1),e(t).severity?(a(),n("span",{key:0,class:F([{"bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100":e(t).severity==="high","bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100":e(t).severity==="medium"},"px-2 py-1 text-xs rounded-full"])},r(e(t).severity==="high"?"Критичный":"Важный"),3)):c("",!0)]),s("p",Xe,r(e(t).instruction),1),e(t).tip?(a(),n("div",Ye,[s("div",Ze,[o[11]||(o[11]=s("svg",{class:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),s("p",et,r(e(t).tip),1)])])):c("",!0),e(H)?(a(),n("div",tt,[(a(!0),n(y,null,k(Q(),i=>(a(),n("div",{key:i.url,class:"flex items-center space-x-2"},[o[12]||(o[12]=s("svg",{class:"w-5 h-5 text-green-600",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{d:"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"}),s("path",{d:"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-1a1 1 0 10-2 0v1H5V7h1a1 1 0 000-2H5z"})],-1)),s("a",{href:i.url,target:"_blank",class:"text-green-800 dark:text-green-200 hover:underline"},r(i.description),9,st),i.hideIP?(a(),n("span",lt,"(скрыть IP)")):c("",!0)]))),128))])):c("",!0),e(t).userConfirmation?(a(),n("div",ot,[s("h4",nt,r(e(t).userConfirmation.question),1),s("div",at,[(a(!0),n(y,null,k(e(t).userConfirmation.options,i=>(a(),n("button",{key:i.text,onClick:g=>W(i),class:"w-full text-left px-3 py-2 text-sm bg-white dark:bg-gray-800 border border-yellow-300 dark:border-yellow-600 rounded hover:bg-yellow-100 dark:hover:bg-yellow-800 transition-colors"},r(i.text),9,it))),128))])])):c("",!0),e(t).progress&&e($)?(a(),n("div",rt,[o[13]||(o[13]=s("div",{class:"flex items-center space-x-3"},[s("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),s("span",{class:"text-blue-800 dark:text-blue-200"},"Выполняется поиск каналов...")],-1)),s("div",ct,[s("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:ce(`width: ${e(x)}%`)},null,4)])])):c("",!0)]),s("div",ut,[e(d)>0?(a(),n("button",{key:0,onClick:J,class:"btn-secondary min-w-[120px]"}," ← Назад ")):c("",!0),z()?(a(),n("button",{key:1,onClick:j,class:"btn-primary min-w-[120px]",disabled:!q()}," Далее → ",8,dt)):G()?(a(),n("button",{key:2,onClick:te,class:"bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200 min-w-[120px]"}," Завершить ")):c("",!0),e(t).ifNoResult?(a(),n("button",{key:3,onClick:X,class:"bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 text-sm min-w-[120px]"}," Не помогло ")):c("",!0)])])]),e(p)?(a(),n("div",vt,[s("div",bt,[s("div",gt,[s("div",mt,r(e(v).success?"✅":"❗"),1),s("h3",ft,r(e(v).title),1),s("p",pt,r(e(v).description),1),e(v).options?(a(),n("div",ht,[(a(!0),n(y,null,k(e(v).options,i=>(a(),n("button",{key:i.text,onClick:g=>Y(i),class:"w-full py-3 px-4 text-left bg-gray-50 dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},r(i.text),9,_t))),128))])):e(v).action?(a(),n("div",xt,[s("button",{onClick:Z,class:"w-full bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200"},r(e(v).action.buttonText),1)])):(a(),n("button",{key:2,onClick:o[2]||(o[2]=i=>p.value=!1),class:"w-full btn-primary"}," Закрыть "))])])])):c("",!0),e(t).audio_url?(a(),n("div",yt,[s("button",{onClick:se,class:"bg-primary-600 hover:bg-primary-700 text-white p-3 rounded-full shadow-lg transition-all duration-200 relative",title:e(f)?"Остановить озвучку":"Воспроизвести озвучку"},[e(f)?(a(),n("svg",wt,o[14]||(o[14]=[s("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"},null,-1)]))):(a(),n("svg",Ct,o[15]||(o[15]=[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z","clip-rule":"evenodd"},null,-1)]))),e(f)?(a(),n("div",St)):c("",!0)],8,kt),s("audio",{ref_key:"audioPlayer",ref:w,src:e(t).audio_url,onEnded:o[3]||(o[3]=i=>f.value=!1),onPlay:o[4]||(o[4]=i=>f.value=!0),onPause:o[5]||(o[5]=i=>f.value=!1)},null,40,$t)])):c("",!0)])}}},qt=ue(It,[["__scopeId","data-v-16f940dc"]]);export{qt as _};
