import{_ as F}from"./D4a6TBNS.js";import{k as E,r as x,j as L,u as z,c as i,a as t,h as $,x as p,y as b,g as s,z as q,F as w,m as h,D as V,t as l,C as N,B as A,o as d,b as H,w as I,d as P}from"./sX_wM5Ua.js";import{u as U}from"./bGbag7Rw.js";import"./BHIvy5Tm.js";import"./DTcQ41cH.js";const K={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},O={class:"flex justify-between items-center mb-8"},R={class:"mb-6"},W=["value"],G={class:"card overflow-hidden"},J={class:"overflow-x-auto"},Q={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},X={class:"bg-white dark:bg-dark-100 divide-y divide-gray-200 dark:divide-gray-700"},Y={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white"},Z={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white"},tt={class:"flex items-center space-x-2"},et={class:"text-lg"},rt={key:0,class:"px-2 py-1 text-xs bg-red-100 text-red-800 dark:bg-red-800 dark:text-red-100 rounded-full"},st={key:1,class:"px-2 py-1 text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100 rounded-full"},ot={key:2,class:"px-2 py-1 text-xs bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100 rounded-full"},at={class:"px-6 py-4 text-sm text-gray-600 dark:text-gray-400"},it={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400"},dt={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},lt={class:"flex justify-end space-x-2"},nt=["onClick"],ut=["onClick"],pt={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},mt={class:"inline-block align-bottom bg-white dark:bg-dark-100 rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},xt={class:"bg-white dark:bg-dark-100 px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},yt={class:"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4"},ct={class:"space-y-4"},gt=["value"],bt={class:"grid grid-cols-2 gap-4"},vt={class:"bg-gray-50 dark:bg-gray-800 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},ft=["disabled"],$t={__name:"errors",async setup(kt){let n,y;const{data:v}=([n,y]=E(()=>U("/api/devices","$CwhKpIua1A")),n=await n,y(),n),{data:_,refresh:C}=([n,y]=E(()=>U("/api/errors/all","$f7c1uWTHgr")),n=await n,y(),n),m=x(""),f=x(!1),u=x(null),c=x(!1),a=x({device_id:"",title:"",description:"",icon:"⚠️",severity:"medium"}),D=L(()=>m.value?_.value.filter(o=>o.device_id==m.value):_.value),T=o=>{var g;const e=(g=v.value)==null?void 0:g.find(r=>r.id===o);return e?e.name:"Неизвестно"},M=o=>{u.value=o,a.value={device_id:o.device_id,title:o.title,description:o.description,icon:o.icon||"⚠️",severity:o.severity||"medium"}},k=()=>{f.value=!1,u.value=null,a.value={device_id:"",title:"",description:"",icon:"⚠️",severity:"medium"}},S=async()=>{c.value=!0;try{u.value?await $fetch(`/api/admin/error/${u.value.id}`,{method:"PUT",body:a.value}):await $fetch("/api/admin/error",{method:"POST",body:a.value}),await C(),k()}catch(o){console.error("Error saving error:",o),alert("Ошибка при сохранении ошибки")}c.value=!1},j=async o=>{if(confirm(`Вы уверены, что хотите удалить ошибку "${o.title}"?`))try{await $fetch(`/api/admin/error/${o.id}`,{method:"DELETE"}),await C()}catch(e){console.error("Error deleting error:",e),alert("Ошибка при удалении ошибки")}};return z({title:"Управление ошибками - Админ-панель"}),(o,e)=>{const g=F;return d(),i("div",K,[t("div",O,[e[8]||(e[8]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"Управление ошибками"),t("p",{class:"mt-2 text-gray-600 dark:text-gray-400"}," Настройт�� типы ошибок для каждой приставки ")],-1)),t("button",{onClick:e[0]||(e[0]=r=>f.value=!0),class:"btn-primary"}," + Добавить ошибку ")]),t("div",R,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Фильтр по приставке ",-1)),p(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>q(m)?m.value=r:null),class:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},[e[9]||(e[9]=t("option",{value:""},"Все приставки",-1)),(d(!0),i(w,null,h(s(v),r=>(d(),i("option",{key:r.id,value:r.id},l(r.name),9,W))),128))],512),[[b,s(m)]])]),t("div",G,[e[13]||(e[13]=t("div",{class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"}," Список ошибок ")],-1)),t("div",J,[t("table",Q,[e[12]||(e[12]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Приставка "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Ошибка "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Описание "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Шаги "),t("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Действия ")])],-1)),t("tbody",X,[(d(!0),i(w,null,h(s(D),r=>(d(),i("tr",{key:r.id},[t("td",Y,l(T(r.device_id)),1),t("td",Z,[t("div",tt,[t("span",et,l(r.icon||"⚠️"),1),t("span",null,l(r.title),1),r.severity==="high"?(d(),i("span",rt," Высокий ")):r.severity==="medium"?(d(),i("span",st," Средний ")):r.severity==="low"?(d(),i("span",ot," Низкий ")):$("",!0)])]),t("td",at,l(r.description),1),t("td",it,l(r.step_count||0)+" шагов ",1),t("td",dt,[t("div",lt,[H(g,{to:`/admin/steps?error=${r.id}`,class:"text-primary-600 hover:text-primary-900 transition-colors"},{default:I(()=>e[11]||(e[11]=[P(" Шаги ")])),_:2,__:[11]},1032,["to"]),t("button",{onClick:B=>M(r),class:"text-blue-600 hover:text-blue-900 transition-colors"}," Изменить ",8,nt),t("button",{onClick:B=>j(r),class:"text-red-600 hover:text-red-900 transition-colors"}," Удалить ",8,ut)])])]))),128))])])])]),s(f)||s(u)?(d(),i("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:k},[t("div",pt,[e[22]||(e[22]=t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"},null,-1)),t("div",mt,[t("form",{onSubmit:V(S,["prevent"]),onClick:e[7]||(e[7]=V(()=>{},["stop"]))},[t("div",xt,[t("h3",yt,l(s(u)?"Редактировать ошибку":"Добавить ошибку"),1),t("div",ct,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Приставка ",-1)),p(t("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>s(a).device_id=r),required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},[e[14]||(e[14]=t("option",{value:""},"Выберите приставку",-1)),(d(!0),i(w,null,h(s(v),r=>(d(),i("option",{key:r.id,value:r.id},l(r.name),9,gt))),128))],512),[[b,s(a).device_id]])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Название ошибки ",-1)),p(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>s(a).title=r),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"Например: Нет сигнала"},null,512),[[N,s(a).title]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Описание ",-1)),p(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=r=>s(a).description=r),rows:"3",class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white",placeholder:"Подробное описание проблемы"},null,512),[[N,s(a).description]])]),t("div",bt,[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Иконка ",-1)),p(t("select",{"onUpdate:modelValue":e[5]||(e[5]=r=>s(a).icon=r),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},e[18]||(e[18]=[A('<option value="⚠️">⚠️ Предупреждение</option><option value="📵">📵 Нет сигнала</option><option value="🔇">🔇 Нет звука</option><option value="📺">📺 Изображение</option><option value="🔌">🔌 Питание</option><option value="💾">💾 Запись</option><option value="🌐">🌐 Интернет</option><option value="❄️">❄️ Зависание</option><option value="🐌">🐌 Медленно</option><option value="🔒">🔒 Закодировано</option>',10)]),512),[[b,s(a).icon]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," Приоритет ",-1)),p(t("select",{"onUpdate:modelValue":e[6]||(e[6]=r=>s(a).severity=r),class:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"},e[20]||(e[20]=[t("option",{value:"low"},"Низкий",-1),t("option",{value:"medium"},"Средний",-1),t("option",{value:"high"},"Высокий",-1)]),512),[[b,s(a).severity]])])])])]),t("div",vt,[t("button",{type:"submit",disabled:s(c),class:"btn-primary"},l(s(c)?"Сохранение...":"Сохранить"),9,ft),t("button",{type:"button",onClick:k,class:"btn-secondary mr-3"}," Отмена ")])],32)])])])):$("",!0)])}}};export{$t as default};
